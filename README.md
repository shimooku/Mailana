# Mailana説明書

8July2023 下奥

24 May 2023 下奥

## [機能]

指定された入力ファイルに**メールヘッダに相当する行がある場合**、下記情報を取り除いたファイルを、指定フォルダの下に、入力ファイル名を変えずに保存する。

削除する情報：

* メールヘッダ（From: To: Subject: Send: Cc: Date: 差出人: 送信日時: 宛先: CC: 件名:）
* 署名と判断した情報（意味理解はせず、ルールベースで判断している）

##  [署名判定の基準]

* **メールヘッダとメール終端の間**、もしくは**メールヘッダと（引用）メールヘッダの間**の行に**文字の繰返しパターン**が見られる場合は、それを**署名領域の開始マーク**と見なす。

* 文字の繰返しパターンとして認識するのは1～5文字の繰返しパターン
  例）

  ```
  **************************  1文字の繰返し例
  *-*-*-*-*-*-*-*-*-*-*-*-*-  2文字の繰返し例
  *_.*_.*_.*_.*_.*_.*_.*_.*_  3文字の繰返し例
  ```

* 途中から繰返しパターンが出現するケースも認識する
  例）

  ```
  ◆◇◎〇____________________  _の繰り返しを検出
  ```

* 全角文字と半角文字の混在パターンも認識する
  例）

  ```
  ＄$＄$＄$＄$＄$＄$＄$＄$＄$＄$  ＄$の繰返しを検出
  ```

  

## [調整可能なパラメータ]

#### 繰返しパターンを検知する際の"最小繰返し数"指定

* デフォルト値は４回
* 例えばパターンが `*_`である場合、それが```*_*_*_*_```のように１行中に４回連続して出現したら、署名のマークと見なす

* コマンドの第３引数として”最小繰返し数"を指定する事ができる

#### 繰返しパターンを検知する際の"繰返しパターン最大文字数"指定

デフォルトは５文字で、これは１～５文字で構成されるパターンを検知する事を意味する。

​	**1**文字の**パターン例**  ```**********``` あるいは ```＊＊＊＊＊＊＊＊＊＊```

​	**2**文字の**パターン例**  ```*_*_*_*_*_``` あるいは ```＊＿＊＿＊＿＊＿＊＿```

​	**3**文字の**パターン例**  ```*..*..*..*``` あるいは ```＊。。＊。。＊。。＊```

​	**4**文字の***パターン例***  ```OO..OO..OO``` あるいは ```ＯＯ。。ＯＯ。。ＯＯ```

​	**5**文字の**パターン例 ** ```..●oO..●oO``` あるいは ```..●○◯..●○◯..●○◯```

#### マークと見なさない"例外パターン"指定

exeと同じフォルダに```ExceptionList.dat```という名前のファイルに、繰返しと見なさないパターンを登録する事で、処理結果に影響を与える事ができる。

すでにある```ExceptionList.dat```には、①全角スペース、②半角スペース、③ `^`、④タブ の4文字を登録している。これによって、全角スペースの連続、半角スペースの連続、 タブ文字の連続をマークと見なさないようにしている。

```
[　] ; 全角スペース
[ ] ; 半角スペース
[	] ; タブスペース
```

```ExceptionList.dat```には[ ]カッコの間に該当するパターンを記入するだけで良い。

* 1行に1パターンを記載する
* [ ]カッコ内の文字(列)を例外対象とする繰返しパターン要素として認識
* [ ]カッコの後ろに数字Nを指定した場合は、[ ]カッコで指定した文字列のN回以下の繰返しが例外扱い（サイン・マークと見なさない）になる

```
[0] 5; 0の5回以下の連続は例外として扱う。例えば 000001234 は繰返しパターンとは見なさず、0000001234 は繰返しパターンと見なす
```



* ; 以降の情報は無視する
* `[` `]`を指定する場合は、`[\[] ` `[\]]` のよう`\`を付けて記載する

## [制約]  <<<<<<<<<< 重要!!

* 繰返しパターンを署名開始のマークと見なして処理するため、繰返しパターンで囲われていない署名は検知できない。
* 繰返しパターンからメールヘッダあるいはメール終端までをシグネチャと見なすため、引用メールからメールヘッダが削除されている場合は、本文もシグネチャと見なしてしまう。

## [動作に必要なファイル]

* kickSignAway.exe
* ExceptionList.dat

## [コマンド引数（オリジナル）]

第一パラメータ：入力ファイル（ワイルドカード指定が可能）

第二パラメータ：出力フォルダ（フォルダは予め作っておく必要あり）

第三パラメータ（オプション）：[繰返しパターンを検知する際の"最小繰返し数" ](# 繰返しパターンを検知する際の"繰返しパターン最大文字数")

第四パラメータ（オプション）：[繰返しパターンを検知する際の"繰返しパターン最大文字数"](#繰返しパターンを検知する際の"繰返しパターン最大文字数)

```
> kickSignAway c:\受領データ\text\*.txt   c:\受領データ\output    4        5
                 ^                        ^                   ^         ^
           入力ファイル指定           出力フォルダ指定   パターンの最小繰返し数 パターンの最大文字数
```

注意）パスにスペースが入っている場合は " " で囲む必要あり



## [コマンド引数（オプション指定方式）]

| オプション指定 | パラメータ                                                   |
| :------------: | ------------------------------------------------------------ |
|    **-i **     | 入力ファイル（ワイルドカード指定が可能）                     |
|     **-o**     | 出力フォルダ（フォルダは予め作っておく必要あり）             |
|     **-t**     | [繰返しパターンを検知する際の"最小繰返し数" ](# 繰返しパターンを検知する際の"繰返しパターン最大文字数") |
|     **-l**     | [繰返しパターンを検知する際の"繰返しパターン最大文字数"](#繰返しパターンを検知する際の"繰返しパターン最大文字数) |
|     **-r**     | 取り除き対象情報だけを出力する（検証用）                     |

メールヘッダと署名を取り除く場合

```
> kickSignAway -i c:\受領データ\text\*.txt -o c:\受領データ\output -t 4 -l 5
```

メールヘッダを署名だけを出力する場合（-rオプションを付ける）

```
> kickSignAway -i c:\受領データ\text\*.txt -o c:\受領データ\output -t 4 -l 5 -r
```

